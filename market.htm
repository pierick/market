<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">

/**
*
*/
function ordre(prix, quantite, sens) {
    //date = new Date();  
    //this.id = id;
    this.prix = prix;
    this.quantite = quantite;
	this.sens = sens;
    //this.date = date.getTime();
    if(quantite && prix && (sens == 'A' || sens == 'V')) {
        carnet.add(this);
    }
};

/**
*
*/
function carnet() {
  this.achats = new Array();
  this.ventes = new Array();
}
carnet.prototype.add = function(ordre) {

	if(ordre.sens == "A") {
		this.achats.push(ordre);
	}
	else if(ordre.sens == "V") {
		this.ventes.push(ordre);
	}
	
	this.sort();
	
	if(this.achats[0] && this.ventes[0]) {
		if(this.achats[0]["prix"] >= this.ventes[0]["prix"]) {
			
			q = this.achats[0]["quantite"] - this.ventes[0]["quantite"];
			
			/*
			if(q >= 0) {
				this.achats.shift();
			} else if(q <= 0) {
				this.ventes.shift();
			}
			*/
			
			// this.add ...
			//o = new ordre(this.achats[0]["prix"], q, 'A');
			
		}
	}
	
	/*
	for (var i = 0; i < colors.length; i++) {
		alert(colors[i]);
	}
	*/

	
}
carnet.prototype.sort = function() {
    function cmp(x, y) {
        return x > y ? 1 : x < y ? -1 : 0;
    }
    this.achats.sort(function(a, b) {
        return [
            -cmp(a.prix, b.prix), cmp(a.id, b.id)
        ] < [
            -cmp(b.prix, a.prix), cmp(b.id, a.id)
        ] ? -1 : 1;
    });
    this.ventes.sort(function(a, b) {
        return [
            cmp(a.prix, b.prix), cmp(a.id, b.id)
        ] < [
            cmp(b.prix, a.prix), cmp(b.id, a.id)
        ] ? -1 : 1;
    });
}

function passOrdre() {
	lignes = document.getElementById('lignes');
	prix = document.getElementById('prix').value;
	quantite = document.getElementById('quantite').value;
	radioObj = document.getElementsByName('sens');
	
	for(var i = 0; i < radioObj.length; i++) {
		if(radioObj[i].checked) {
			sens = radioObj[i].value;
		}
	}
	
	//o = new ordre(prix, quantite, sens);
	
	type = {A:"achat", V:"ventes"};
	
	ordre = document.createElement("p");
	content = document.createTextNode(type[sens] + ' de ' + quantite + ' unitÃ©s pour ' + prix + " $");
  ordre.appendChild(content);
  
  if(lignes.firstChild) {
  	lignes.insertBefore(ordre, lignes.firstChild);
  } else {
  	lignes.appendChild(ordre);
  }

}

/*---------------------------------------------------------*/

//console.debug(carnet);

carnet = new carnet();

</script>

<style>

* {
margin: 0;
padding: 0;
}

#lignes {
	display: inline-block;
	overflow-y: auto;
	height: 200px;
	padding: 0 30px;
	border: 1px solid gray;
}
p {
	white-space: nowrap;
}
</style>

</head>
<body>
<div>
quantite <input type="text" id="quantite" name="quantite" size="3" value="10" />
prix <input type="text" id="prix" name="prix" size="3"  value="100" />
Achat <input type="radio" name="sens" id="a" value="A" checked="checked" />
Vente <input type="radio" name="sens" id="v" value="V" />
<input type="button" id="button" name="button" value="ok" onclick="passOrdre();" />
</div>
<div id="lignes"></div>

</body>
</html>
